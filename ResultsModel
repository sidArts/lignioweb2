<?php defined('BASEPATH') OR exit('No direct script access allowed');

class ResultsModel extends MY_model
{

	protected $_table = "diagnostic_test_results";
  
   function_ReportsInsert($data)
   {
   $count=count($data['count'];
   	for($i=0;$i<$count;$i++)
   	{
       $entries=array(
         $booking_id=$data['jbooking_id']['$i'],
         $test_param_id=$data['jtest_param_id'][$i],
         $value=$data['jvalue'][$i],
    );
   	}
   	$this->db->insert_batch('diagnostic_test_results', $entries); 
     if($this->db->affected_rows() > 0)
    return 1;
     else
    return 0;
}
}

 function reportsSend($booking_id)
 {
 	$sql='SELECT 
eu.firstname,eu.lastname,eu.email,eu.address,eu.phone,eu.email,tr.value,tr.is_alarming,mdtp.description,mdtp.healthy_range,mdtp.name
FROM diagnostic_test_results tr

JOIN master_diagnostic_test_params mdtp
ON tr.test_param_id = mdtp.id

JOIN end_users eu 
ON eu.id = (select end_user_id from bookings where booking_id = $booking_id)

WHERE tr.booking_id = $booking_id';
$query = $this->db->query($sql, $booking_id);
    return $query->result_array();
 }

